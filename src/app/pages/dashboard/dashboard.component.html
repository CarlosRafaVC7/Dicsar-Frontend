<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <div>
      <h1>ğŸ“Š Dashboard Administrativo</h1>
      <p class="subtitle">Sistema de GestiÃ³n Integral DICSAR</p>
    </div>
  </div>

  <!-- KPI Cards - Resumen General -->
  <div class="kpi-grid">
    <div class="kpi-card sistema">
      <div class="kpi-icon">ğŸ‘¥</div>
      <div class="kpi-content">
        <div class="kpi-label">Usuarios Activos</div>
        <div class="kpi-value">{{ usuariosActivos }}/{{ totalUsuarios }}</div>
        <div class="kpi-meta">del total de usuarios</div>
      </div>
    </div>

    <div class="kpi-card inventario">
      <div class="kpi-icon">ğŸ“¦</div>
      <div class="kpi-content">
        <div class="kpi-label">Productos</div>
        <div class="kpi-value">{{ productosTotal }}</div>
        <div class="kpi-meta">en inventario</div>
      </div>
    </div>

    <div class="kpi-card movimientos">
      <div class="kpi-icon">ğŸ“‹</div>
      <div class="kpi-content">
        <div class="kpi-label">Movimientos</div>
        <div class="kpi-value">{{ movimientos.length }}</div>
        <div class="kpi-meta">registrados</div>
      </div>
    </div>

    <div class="kpi-card ventas">
      <div class="kpi-icon">ğŸ’°</div>
      <div class="kpi-content">
        <div class="kpi-label">Ventas</div>
        <div class="kpi-value">{{ salidasCount }}</div>
        <div class="kpi-meta">movimientos de salida</div>
      </div>
    </div>
  </div>

  <!-- GrÃ¡ficos Principales -->
  <div class="charts-section" *ngIf="!loading">
    <div class="chart-grid">
      <!-- GrÃ¡fico de Movimientos -->
      <div class="card chart-card">
        <div class="card-header">
          <h3>ğŸ“Š DistribuciÃ³n de Movimientos</h3>
        </div>
        <div class="card-body chart-body">
          <canvas baseChart [type]="'bar'" [data]="chartMovimientosConfig.data"
            [options]="chartMovimientosConfig.options">
          </canvas>
        </div>
      </div>

      <!-- GrÃ¡fico de Ventas Mensuales -->
      <div class="card chart-card">
        <div class="card-header">
          <h3>ğŸ“ˆ Ventas Mensuales</h3>
        </div>
        <div class="card-body chart-body">
          <canvas baseChart [type]="'line'" [data]="chartVentasMensualesConfig.data"
            [options]="chartVentasMensualesConfig.options">
          </canvas>
        </div>
      </div>

      <!-- GrÃ¡fico de Productos -->
      <div class="card chart-card">
        <div class="card-header">
          <h3>ğŸ† Productos MÃ¡s Vendidos</h3>
        </div>
        <div class="card-body chart-body">
          <canvas baseChart [type]="'doughnut'" [data]="chartProductosConfig.data"
            [options]="chartProductosConfig.options">
          </canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="main-grid" *ngIf="!loading">
    <!-- Left Column -->
    <div class="left-column">
      <!-- Resumen de Movimientos -->
      <div class="card">
        <div class="card-header">
          <h3>ğŸ“¦ Resumen de Movimientos</h3>
        </div>
        <div class="card-body">
          <div class="movement-summary">
            <div class="movement-item salida">
              <div class="movement-icon">â¬‡ï¸</div>
              <div class="movement-info">
                <div class="movement-label">Salidas</div>
                <div class="movement-count">{{ salidasCount }}</div>
              </div>
            </div>
            <div class="movement-item entrada">
              <div class="movement-icon">â¬†ï¸</div>
              <div class="movement-info">
                <div class="movement-label">Entradas</div>
                <div class="movement-count">{{ entradasCount }}</div>
              </div>
            </div>
            <div class="movement-item ajuste">
              <div class="movement-icon">ğŸ”„</div>
              <div class="movement-info">
                <div class="movement-label">Ajustes</div>
                <div class="movement-count">{{ ajustesCount }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Productos con Stock Bajo -->
      <div class="card">
        <div class="card-header">
          <h3>âš ï¸ Productos con Stock Bajo</h3>
        </div>
        <div class="card-body">
          <div *ngIf="stockBajo.length > 0" class="stock-list">
            <div class="stock-item" *ngFor="let producto of stockBajo">
              <div class="stock-info">
                <div class="stock-nombre">{{ producto.nombre }}</div>
                <div class="stock-meta">Stock: {{ producto.stockActual || producto.stock || 0 }} unidades</div>
              </div>
              <div class="stock-badge">âš ï¸</div>
            </div>
          </div>
          <div *ngIf="stockBajo.length === 0" class="empty-state">
            <p>âœ… Todos los productos tienen stock adecuado</p>
          </div>
        </div>
      </div>

      <!-- ğŸ†• Productos con Problemas de Vencimiento -->
      <div class="card alert-card-section" *ngIf="productosVencidos.length > 0 || productosProximosAVencer.length > 0">
        <div class="card-header">
          <h3>ğŸ“Œ Alertas de Vencimiento</h3>
        </div>
        <div class="card-body">
          <!-- Productos Vencidos -->
          <div class="alert-vencimiento-dashboard" *ngIf="productosVencidos.length > 0">
            <div class="alert-header-vencimiento">
              <span class="alert-icon">ğŸš«</span>
              <span class="alert-titulo">{{ productosVencidos.length }} Producto(s) Vencido(s)</span>
            </div>
            <div class="alert-items-vencimiento">
              <div class="alert-item-vencimiento" *ngFor="let p of productosVencidos">
                <strong>{{ p.nombre }}</strong> - Vencimiento: {{ p.fechaVencimiento | date:'dd/MM/yyyy' }}
              </div>
            </div>
          </div>

          <!-- Productos PrÃ³ximos a Vencer -->
          <div class="alert-proximo-dashboard" *ngIf="productosProximosAVencer.length > 0">
            <div class="alert-header-vencimiento">
              <span class="alert-icon">â°</span>
              <span class="alert-titulo">{{ productosProximosAVencer.length }} Producto(s) PrÃ³ximo(s) a Vencer</span>
            </div>
            <div class="alert-items-vencimiento">
              <div class="alert-item-vencimiento" *ngFor="let p of productosProximosAVencer">
                <strong>{{ p.nombre }}</strong> - Vence en {{ getDiasParaVencer(p.fechaVencimiento) }} dÃ­as
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column -->
    <div class="right-column">
      <!-- Productos MÃ¡s Vendidos -->
      <div class="card">
        <div class="card-header">
          <h3>ğŸ† Top 5 Productos</h3>
        </div>
        <div class="card-body">
          <div *ngIf="productosMasVendidos.length > 0" class="table-responsive">
            <table class="table-compact">
              <tbody>
                <tr *ngFor="let producto of productosMasVendidos.slice(0, 5); let i = index" class="table-row">
                  <td class="rank">{{ i + 1 }}</td>
                  <td class="name">{{ producto[0] }}</td>
                  <td class="value">{{ producto[1] }} unidades</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div *ngIf="productosMasVendidos.length === 0" class="empty-state">
            <p>ğŸª Sin ventas de productos registradas</p>
          </div>
        </div>
      </div>

      <!-- Clientes Top -->
      <div class="card">
        <div class="card-header">
          <h3>ğŸ‘¥ Clientes Principales</h3>
        </div>
        <div class="card-body">
          <div *ngIf="clientesTopCompras.length > 0" class="table-responsive">
            <table class="table-compact">
              <tbody>
                <tr *ngFor="let cliente of clientesTopCompras.slice(0, 5); let i = index" class="table-row">
                  <td class="rank">{{ i + 1 }}</td>
                  <td class="name">{{ cliente[0] }}</td>
                  <td class="value">{{ formatearMoneda(cliente[2]) }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div *ngIf="clientesTopCompras.length === 0" class="empty-state">
            <p>ğŸ“­ Sin datos de compras registradas</p>
          </div>
        </div>
      </div>

      <!-- Totales Mensuales -->
      <div class="card">
        <div class="card-header">
          <h3>ğŸ“… Ventas por Mes</h3>
        </div>
        <div class="card-body">
          <div *ngIf="totalesMensuales.length > 0" class="table-responsive">
            <table class="table-compact">
              <tbody>
                <tr *ngFor="let mes of totalesMensuales; let i = index" class="table-row">
                  <td class="name">{{ mes[0] }}-{{ mes[1] < 10 ? '0' + mes[1] : mes[1] }}</td>
                  <td class="value">{{ formatearMoneda(mes[2]) }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div *ngIf="totalesMensuales.length === 0" class="empty-state">
            <p>ğŸ“… Sin ventas registradas en el perÃ­odo vÃ¡lido</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>â³ Cargando datos del sistema...</p>
  </div>
</div>